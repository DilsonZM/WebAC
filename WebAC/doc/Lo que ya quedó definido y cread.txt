1) Lo que ya quedÃ³ definido y creado (modelo mÃ­nimo blindado)
Lista 1 â€” EquiposAC (maestra de activos + jerarquÃ­a)

PropÃ³sito: fuente Ãºnica para jerarquÃ­a y para cargar combos â€œen cascadaâ€.

Campos mÃ­nimos (en este orden lÃ³gico):

Title (lo usas como EquipNo) â€” Texto

NombreEquipo â€” Texto

BranchGerencia â€” Texto

SiteSuperintendencia â€” Texto

UnidadProceso â€” Texto

Fleet â€” Texto âœ… (dijiste que asÃ­ se llama)

ProcesoSistema â€” Texto

EGI â€” Texto

Estado â€” Choice (DI/â€¦ opcional)

ğŸ“Œ Clave: el usuario nunca debe â€œinventarâ€ jerarquÃ­a: todo sale de aquÃ­.

Lista 2 â€” EscenariosAC (evento/observaciÃ³n base predefinida)

PropÃ³sito: contiene el texto fijo que el usuario SOLO LEE (no lo escribe), y que habilita responder las 10 preguntas.

Campos mÃ­nimos:

Title â€” Texto (nombre corto del escenario)

Activo â€” SÃ­/No (default SÃ­)

NivelAplicacion â€” Choice:

Corporativo, Fleet, ProcesoSistema, EGI, Equipo

BranchGerencia â€” Texto (opcional)

Fleet â€” Texto (opcional)

ProcesoSistema â€” Texto (opcional)

EGI â€” Texto (opcional)

EquipNo â€” Texto (opcional)

EventoAnalizado â€” Varias lÃ­neas (Plain text) âœ… obligatorio

ğŸ“Œ Regla: para cada escenario defines â€œa quÃ© nivel aplicaâ€.
Ejemplo: si aplica a EGI=WINCHEP1, entonces NivelAplicacion=EGI y EGI=WINCHEP1.

Lista 3 â€” EvaluacionesAC (hechos / histÃ³rico)

PropÃ³sito: 1 evaluaciÃ³n = 1 fila, con snapshot del evento y las 10 respuestas.

Campos mÃ­nimos:

Title â€” Texto (ej: EVAL-YYYYMMDD-EquipNo)

EquipNo â€” Texto âœ…

EGI â€” Texto

ProcesoSistema â€” Texto

Fleet â€” Texto

EscenarioId â€” NÃºmero âœ…

EventoAnalizadoSnapshot â€” Varias lÃ­neas (Plain text) âœ…

FO â€” NÃºmero

FIN â€” NÃºmero

HSE â€” NÃºmero

MA â€” NÃºmero

SOC â€” NÃºmero

DDHH â€” NÃºmero

REP â€” NÃºmero

LEGAL â€” NÃºmero

TI â€” NÃºmero

FF â€” NÃºmero

NC â€” NÃºmero (si aplica)

Justificacion â€” Varias lÃ­neas (Plain text) âœ…

Evaluador â€” Persona/Grupo âœ…

FechaEvaluacion â€” Fecha/hora âœ…

ğŸ“Œ Importante: esto es solo consulta para usuarios normales. EdiciÃ³n solo admin.

2) Lo que se debe construir (aplicaciÃ³n sin NPM, profesional y rÃ¡pida)
2.1 Arquitectura de pantallas (simple y profesional)

Sin frameworks, pero con UI â€œBI styleâ€.

A) Dashboard / Inicio (estadÃ­stico)

Tarjetas KPI:

Evaluaciones (hoy / 7 dÃ­as / mes)

Equipos evaluados (distintos)

Top EGI con mÃ¡s evaluaciones

Pendientes (si lo implementas)

GrÃ¡ficos simples (sin librerÃ­as):

barra â€œevaluaciones por Fleetâ€

tabla â€œÃºltimas 20 evaluacionesâ€

BotÃ³n principal: â€œNueva evaluaciÃ³nâ€

âœ… Todo sale de EvaluacionesAC con filtros por fecha.

B) Wizard â€œNueva evaluaciÃ³nâ€ (con confirmaciÃ³n final)

Paso 1 â€” SelecciÃ³n del nivel a evaluar

Dropdown: Fleet | ProcesoSistema | EGI | Equipo

Paso 2 â€” Cascada (solo lo necesario)
AquÃ­ es donde lo haces pro y evitas cargar 5000 combos de golpe:

Si eligiÃ³ Fleet:

Select Fleet (se carga con distinct desde EquiposAC.Fleet)

Cobertura: #Procesos, #EGI, #Equipos (calculado desde EquiposAC filtrado)

Si eligiÃ³ ProcesoSistema:

Primero Fleet (opcional o requerido segÃºn tu regla)

Luego ProcesoSistema filtrado por Fleet (si Fleet elegido)

Si eligiÃ³ EGI:

Fleet (opcional)

ProcesoSistema (opcional)

EGI filtrado por lo anterior

Si eligiÃ³ Equipo:

BÃºsqueda tipo â€œsearch boxâ€ (no combo gigante)

Resultados paginados (20â€“50)

Selecciona 1 equipo

Paso 3 â€” Evento Analizado (solo lectura)

La app busca escenario con prioridad:

Equipo (EquipNo)

EGI

ProcesoSistema

Fleet

Corporativo

Si NO encuentra: muestra alerta roja:

â€œNo existe escenario activo para esta selecciÃ³n. Contacta al administrador.â€

y bloquea el paso 4.

Paso 4 â€” 10 preguntas

10 selects (1â€“4 o tu escala)

Campo JustificaciÃ³n obligatorio

Paso 5 â€” Resumen / ConfirmaciÃ³n

Muestra:

jerarquÃ­a final (Fleet, Proceso, EGI, Equipo)

escenario usado (Id + tÃ­tulo)

evento analizado (texto)

tabla con las 10 respuestas

BotÃ³n: Confirmar y enviar

Tras guardar: pantalla â€œÃ‰xitoâ€ + link â€œVer evaluaciÃ³nâ€

âœ… Esto reduce errores y evita â€œenviar y arrepentirseâ€.

C) Pantalla â€œMis evaluacionesâ€ (consulta)

Lista paginada (Ãºltimas 50) con filtros:

fecha, Fleet, ProcesoSistema, EGI, EquipNo

Al abrir una: vista detalle solo lectura

Exportar a Excel (opcional, simple: CSV)

2.2 Admin: CRUD + Reabrir evaluaciÃ³n

Sin NPM tambiÃ©n.

Admin Panel (rutas protegidas)

MÃ³dulos:

Equipos

En MVP NO haces CRUD aquÃ­ en la app: eso lo administra SharePoint o carga masiva.

La app solo consulta.

Escenarios

Listado con filtros (NivelAplicacion, Fleet, Proceso, EGI, EquipNo, Activo)

Botones:

Crear

Editar

Activar/Desactivar

Importante: no cargar todo, siempre por filtros o bÃºsqueda.

Evaluaciones

Listado + filtros

Ver detalle

BotÃ³n â€œReabrirâ€:

ImplementaciÃ³n recomendada:

columna nueva en EvaluacionesAC: EstadoEvaluacion (Choice: CERRADA, REABIERTA)

columna ReabiertaPor (Persona)

columna ReabiertaFecha (Fecha)

Cuando admin â€œreabreâ€:

la evaluaciÃ³n vuelve editable solo para admin o para el evaluador (segÃºn regla)

o simplemente crea â€œNueva versiÃ³nâ€ (mejor para auditorÃ­a)

âœ… Para auditorÃ­a, lo mÃ¡s sÃ³lido es versionado:

No editas la fila original.

Creas una nueva fila â€œRevisionDeId = Xâ€.
Pero si quieres simple: usa EstadoEvaluacion.

3) CÃ³mo evitar mostrar 5000 registros â€œde golpeâ€ (sin NPM)

Esto es CLAVE y te quita el 80% de los bugs/performance.

3.1 Cascada basada en â€œdistinctâ€ desde EquiposAC

Cargas EquiposAC una sola vez pero solo con columnas necesarias:

Id, Title, Fleet, ProcesoSistema, EGI, NombreEquipo

Y de ahÃ­ construyes sets:

distinct Fleet

distinct ProcesoSistema filtrado

distinct EGI filtrado

ğŸ‘‰ Si EquiposAC es demasiado grande, haces paginaciÃ³n con @odata.nextLink.

3.2 Equipo NO en combo: es buscador

Input â€œBuscar equipoâ€

Query por prefijo/contiene:

filtro en REST con substringof (clÃ¡sico) o contains (depende config)

Muestras resultados paginados 20.

4) QuÃ© endpoints REST debe usar tu JS (sin SPFx, sin libs)
4.1 Leer Equipos (mÃ­nimo)

EquiposAC:

select mÃ­nimo:

Id,Title,NombreEquipo,Fleet,ProcesoSistema,EGI

paginado:

$top=5000 + @odata.nextLink

4.2 Resolver escenario (lo mÃ¡s importante)

Primero intenta por el nivel mÃ¡s especÃ­fico y vas bajando:

Equipo:

NivelAplicacion eq 'Equipo' and EquipNo eq 'X' and Activo eq 1

EGI:

NivelAplicacion eq 'EGI' and EGI eq 'Y' and Activo eq 1

ProcesoSistema:

NivelAplicacion eq 'ProcesoSistema' and ProcesoSistema eq 'Z' and Activo eq 1

Fleet:

NivelAplicacion eq 'Fleet' and Fleet eq 'F' and Activo eq 1

Corporativo:

NivelAplicacion eq 'Corporativo' and Activo eq 1

âœ… Si hay mÃ¡s de uno, toma el mÃ¡s reciente (Modified desc) o el primero.

4.3 Guardar evaluaciÃ³n (POST)

Inserta en EvaluacionesAC

Copia snapshot del evento.

5) Entregables exactos que te faltan construir

Definir roles/permisos

Usuarios normales: leer EvaluacionesAC (solo suyas o todas segÃºn polÃ­tica), crear evaluaciones

Admin: CRUD EscenariosAC + reabrir evaluaciones

Crear las vistas de SharePoint

EscenariosAC: vistas por NivelAplicacion

EvaluacionesAC: vista â€œPor mesâ€, â€œPor Fleetâ€, â€œReabiertasâ€

(Ayuda cuando la app falle, tienes respaldo)

Implementar app JS â€œlimpiaâ€

spHttp.js (GET paginado, POST, manejo de errores)

catalogService.js (carga EquiposAC â†’ sets)

escenarioService.js (resolver escenario con fallback)

evaluacionesService.js (guardar + listar)

ui/ (wizard + dashboard + admin)

6) Nota sobre tu incidente â€œUnexpected token 'return'â€

Eso pasa cuando alguien metiÃ³ un return suelto en un archivo cargado como mÃ³dulo, o rompiÃ³ la sintaxis (pegar cÃ³digo dentro de string / minificar mal).
Regla para blindarte:

Todo JS como ES modules (import/export) o todo como script clÃ¡sico, pero no mezclado.

Si usas import ... entonces el <script> debe ser type="module".