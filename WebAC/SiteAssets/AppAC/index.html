<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AC - Analisis</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div class="loading-overlay" id="loading-overlay">
    <div class="loading-card">
      <div class="spinner"></div>
      <div class="loading-text">Cargando informaci√≥n...</div>
    </div>
  </div>
  <div class="app-shell">
    <aside class="sidebar">
      <div class="brand">
        <div class="brand-mark">AC</div>
        <div class="brand-text">
          <div class="brand-title">SGIA</div>
          <div class="brand-sub">Analisis de Criticidad</div>
        </div>
      </div>
      <nav class="side-nav">
        <button class="btn side-btn active" id="nav-dashboard" data-view="view-dashboard-advanced">
          <svg class="nav-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 10.5 12 3l9 7.5V21a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1V10.5z"/></svg>
          Inicio
        </button>
        <button class="btn side-btn primary" id="nav-wizard" data-view="view-wizard">
          <svg class="nav-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M6 2h9l5 5v15a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm8 1.5V8h4.5"/></svg>
          Nuevo an√°lisis
        </button>
        <button class="btn side-btn" id="nav-mis" data-view="view-mis">
          <svg class="nav-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4zm0 2c-4.4 0-8 2-8 4.5V21h16v-2.5C20 16 16.4 14 12 14z"/></svg>
          Mis an√°lisis
        </button>
        <button class="btn side-btn" id="nav-all" data-view="view-all">
          <svg class="nav-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M16 11a3 3 0 1 0-3-3 3 3 0 0 0 3 3zM8 11a3 3 0 1 0-3-3 3 3 0 0 0 3 3zm8 2c-2.7 0-5 1.3-5 3v2h10v-2c0-1.7-2.3-3-5-3zM8 13c-2.7 0-5 1.3-5 3v2h7v-2c0-1.7-1-3-2-3z"/></svg>
          Todos los an√°lisis
        </button>
        <button class="btn side-btn hidden" id="nav-admin" data-view="view-admin">
          <svg class="nav-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2a2 2 0 0 1 2 2v1.1a7 7 0 0 1 2.7 1.1l.8-.8a2 2 0 1 1 2.8 2.8l-.8.8A7 7 0 0 1 19 12a7 7 0 0 1-1.1 3.7l.8.8a2 2 0 1 1-2.8 2.8l-.8-.8A7 7 0 0 1 12 19a7 7 0 0 1-3.7-1.1l-.8.8a2 2 0 1 1-2.8-2.8l.8-.8A7 7 0 0 1 5 12a7 7 0 0 1 1.1-3.7l-.8-.8a2 2 0 1 1 2.8-2.8l.8.8A7 7 0 0 1 12 5.1V4a2 2 0 0 1 2-2z"/></svg>
          Admin
        </button>
      </nav>
    </aside>
    <main class="main">
      <div class="topbar">
        <div class="topbar-inner">
          <div>
            <div class="top-title" id="page-title">Analisis de Criticidad</div>
            <div class="top-sub" id="page-subtitle">Resumen general</div>
          </div>
          <div class="topbar-actions">
            <div class="user-card">
              <div class="user-avatar" id="user-avatar">
                <img id="user-photo" alt="Foto de usuario" />
                <span id="user-initials">AC</span>
              </div>
              <div class="user-meta">
                <div class="user-name" id="user-name">Usuario</div>
                <div class="user-email" id="user-email">-</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="container">
        <section id="view-dashboard" class="view">
          <div class="grid kpi kpi-tiles">
            <div class="card metric-card" id="card-flotas">
              <div class="metric-title">Flotas cubiertas</div>
              <div class="metric-value" id="kpi-hoy">-</div>
              <div class="metric-total" id="kpi-flotas-total">-</div>
              <div class="metric-row">
                <span class="metric-up" id="kpi-flotas-pct">‚ñ≤ 0%</span>
                <span class="metric-sub">% cubierto</span>
              </div>
              <div class="metric-row danger">
                <span class="metric-down" id="kpi-flotas-pend">‚ñº 0</span>
                <span class="metric-sub">por analizar</span>
              </div>
              <svg class="spark" viewBox="0 0 120 40" aria-hidden="true">
                <defs>
                  <linearGradient id="spark-grad-flotas" x1="0" x2="0" y1="0" y2="1">
                    <stop offset="0%" stop-color="currentColor" stop-opacity="0.35" />
                    <stop offset="60%" stop-color="currentColor" stop-opacity="0.08" />
                    <stop offset="100%" stop-color="currentColor" stop-opacity="0" />
                  </linearGradient>
                </defs>
                <path class="area" fill="url(#spark-grad-flotas)" d="M2 30 C 18 20, 34 28, 50 18 S 82 12, 118 6 L118 40 L2 40 Z" />
                <path class="line" d="M2 30 C 18 20, 34 28, 50 18 S 82 12, 118 6" />
              </svg>
            </div>
            <div class="card metric-card" id="card-procesos">
              <div class="metric-title">Procesos / Sistemas cubiertos</div>
              <div class="metric-value" id="kpi-procesos-ok">-</div>
              <div class="metric-total" id="kpi-procesos-total">-</div>
              <div class="metric-row">
                <span class="metric-up" id="kpi-procesos-pct">‚ñ≤ 0%</span>
                <span class="metric-sub">% cubierto</span>
              </div>
              <div class="metric-row danger">
                <span class="metric-down" id="kpi-procesos-pend">‚ñº 0</span>
                <span class="metric-sub">por analizar</span>
              </div>
              <svg class="spark" viewBox="0 0 120 40" aria-hidden="true">
                <defs>
                  <linearGradient id="spark-grad-procesos" x1="0" x2="0" y1="0" y2="1">
                    <stop offset="0%" stop-color="currentColor" stop-opacity="0.35" />
                    <stop offset="60%" stop-color="currentColor" stop-opacity="0.08" />
                    <stop offset="100%" stop-color="currentColor" stop-opacity="0" />
                  </linearGradient>
                </defs>
                <path class="area" fill="url(#spark-grad-procesos)" d="M2 32 C 18 24, 38 30, 56 20 S 86 16, 118 12 L118 40 L2 40 Z" />
                <path class="line" d="M2 32 C 18 24, 38 30, 56 20 S 86 16, 118 12" />
              </svg>
            </div>
            <div class="card metric-card" id="card-egis">
              <div class="metric-title">EGI cubiertas</div>
              <div class="metric-value" id="kpi-egi-ok">-</div>
              <div class="metric-total" id="kpi-egi-total">-</div>
              <div class="metric-row">
                <span class="metric-up" id="kpi-egi-pct">‚ñ≤ 0%</span>
                <span class="metric-sub">% cubierto</span>
              </div>
              <div class="metric-row danger">
                <span class="metric-down" id="kpi-egi-pend">‚ñº 0</span>
                <span class="metric-sub">por analizar</span>
              </div>
              <svg class="spark" viewBox="0 0 120 40" aria-hidden="true">
                <defs>
                  <linearGradient id="spark-grad-egis" x1="0" x2="0" y1="0" y2="1">
                    <stop offset="0%" stop-color="currentColor" stop-opacity="0.35" />
                    <stop offset="60%" stop-color="currentColor" stop-opacity="0.08" />
                    <stop offset="100%" stop-color="currentColor" stop-opacity="0" />
                  </linearGradient>
                </defs>
                <path class="area" fill="url(#spark-grad-egis)" d="M2 26 C 20 16, 40 24, 58 12 S 90 10, 118 6 L118 40 L2 40 Z" />
                <path class="line" d="M2 26 C 20 16, 40 24, 58 12 S 90 10, 118 6" />
              </svg>
            </div>
            <div class="card metric-card" id="card-equipos">
              <div class="metric-title">Equipos cubiertos</div>
              <div class="metric-value" id="kpi-equipos-cubiertos">-</div>
              <div class="metric-total" id="kpi-equipos-total">-</div>
              <div class="metric-row">
                <span class="metric-up" id="kpi-equipos-pct">‚ñ≤ 0%</span>
                <span class="metric-sub">% cubierto</span>
              </div>
              <div class="metric-row danger">
                <span class="metric-down" id="kpi-equipos-pend">‚ñº 0</span>
                <span class="metric-sub">por analizar</span>
              </div>
              <svg class="spark" viewBox="0 0 120 40" aria-hidden="true">
                <defs>
                  <linearGradient id="spark-grad-equipos" x1="0" x2="0" y1="0" y2="1">
                    <stop offset="0%" stop-color="currentColor" stop-opacity="0.35" />
                    <stop offset="60%" stop-color="currentColor" stop-opacity="0.08" />
                    <stop offset="100%" stop-color="currentColor" stop-opacity="0" />
                  </linearGradient>
                </defs>
                <path class="area" fill="url(#spark-grad-equipos)" d="M2 28 C 20 18, 38 26, 56 14 S 84 10, 118 8 L118 40 L2 40 Z" />
                <path class="line" d="M2 28 C 20 18, 38 26, 56 14 S 84 10, 118 8" />
              </svg>
            </div>
          </div>
          <div class="grid dash-bottom" style="margin-top: 1.2rem;">
            <div class="card">
              <div class="section-title">An√°lisis por gerencia (equipos cubiertos)</div>
              <div class="geo-grid">
                <div class="chart-center">
                  <canvas id="gerencia-chart"></canvas>
                </div>
              </div>
            </div>
            <div class="card classif-card">
              <div class="section-title">Clasificaci√≥n por Criticidad</div>
              <div class="chart-center">
                <canvas id="criticidad-chart"></canvas>
              </div>
              <div class="classif-legend" id="criticidad-legend"></div>
            </div>
          </div>
        </section>

        <section id="view-dashboard-advanced" class="view active">
          <div class="card adv-filters-card" style="margin-bottom: 1rem;">
            <div class="row adv-filters">
              <div>
                <label>Gerencia</label>
                <select id="adv-gerencia" class="form-select"></select>
              </div>
              <div>
                <label>Superintendencia</label>
                <select id="adv-superintendencia" class="form-select"></select>
              </div>
              <div>
                <label>UnidadProceso</label>
                <select id="adv-unidad" class="form-select"></select>
              </div>
              <div>
                <label>Fleet</label>
                <select id="adv-fleet" class="form-select"></select>
              </div>
              <div>
                <label>ProcesoSistema</label>
                <select id="adv-proceso" class="form-select"></select>
              </div>
              <div>
                <label>EGI</label>
                <select id="adv-egi" class="form-select"></select>
              </div>
              <button class="btn adv-clear-filters-btn" id="adv-clear-filters" title="Limpiar filtros" aria-label="Limpiar filtros">üóëÔ∏è</button>
            </div>
          </div>
          <div class="grid kpi kpi-tiles kpi-7">
            <div class="card metric-card" id="adv-card-gerencia">
              <div class="metric-title">Gerencia cubiertas</div>
              <div class="metric-value" id="adv-gerencia-cov">-</div>
              <div class="metric-total" id="adv-gerencia-total">-</div>
              <div class="metric-row">
                <span class="metric-up" id="adv-gerencia-pct">‚ñ≤ 0%</span>
                <span class="metric-sub">% cubierto</span>
              </div>
              <div class="metric-row danger">
                <span class="metric-down" id="adv-gerencia-cov-pend">‚ñº 0</span>
                <span class="metric-sub">por analizar</span>
              </div>
            </div>
            <div class="card metric-card" id="adv-card-super">
              <div class="metric-title">Superintendencia cubiertas</div>
              <div class="metric-value" id="adv-super-cov">-</div>
              <div class="metric-total" id="adv-super-total">-</div>
              <div class="metric-row">
                <span class="metric-up" id="adv-super-pct">‚ñ≤ 0%</span>
                <span class="metric-sub">% cubierto</span>
              </div>
              <div class="metric-row danger">
                <span class="metric-down" id="adv-super-cov-pend">‚ñº 0</span>
                <span class="metric-sub">por analizar</span>
              </div>
            </div>
            <div class="card metric-card" id="adv-card-unidad">
              <div class="metric-title">UnidadProceso cubiertas</div>
              <div class="metric-value" id="adv-unidad-cov">-</div>
              <div class="metric-total" id="adv-unidad-total">-</div>
              <div class="metric-row">
                <span class="metric-up" id="adv-unidad-pct">‚ñ≤ 0%</span>
                <span class="metric-sub">% cubierto</span>
              </div>
              <div class="metric-row danger">
                <span class="metric-down" id="adv-unidad-cov-pend">‚ñº 0</span>
                <span class="metric-sub">por analizar</span>
              </div>
            </div>
            <div class="card metric-card" id="adv-card-flotas">
              <div class="metric-title">Fleet cubiertas</div>
              <div class="metric-value" id="adv-kpi-flotas-ok">-</div>
              <div class="metric-total" id="adv-kpi-flotas-total">-</div>
              <div class="metric-row">
                <span class="metric-up" id="adv-kpi-flotas-pct">‚ñ≤ 0%</span>
                <span class="metric-sub">% cubierto</span>
              </div>
              <div class="metric-row danger">
                <span class="metric-down" id="adv-kpi-flotas-pend">‚ñº 0</span>
                <span class="metric-sub">por analizar</span>
              </div>
            </div>
            <div class="card metric-card" id="adv-card-procesos">
              <div class="metric-title">ProcesoSistema cubiertos</div>
              <div class="metric-value" id="adv-kpi-procesos-ok">-</div>
              <div class="metric-total" id="adv-kpi-procesos-total">-</div>
              <div class="metric-row">
                <span class="metric-up" id="adv-kpi-procesos-pct">‚ñ≤ 0%</span>
                <span class="metric-sub">% cubierto</span>
              </div>
              <div class="metric-row danger">
                <span class="metric-down" id="adv-kpi-procesos-pend">‚ñº 0</span>
                <span class="metric-sub">por analizar</span>
              </div>
            </div>
            <div class="card metric-card" id="adv-card-egis">
              <div class="metric-title">EGI cubiertas</div>
              <div class="metric-value" id="adv-kpi-egi-ok">-</div>
              <div class="metric-total" id="adv-kpi-egi-total">-</div>
              <div class="metric-row">
                <span class="metric-up" id="adv-kpi-egi-pct">‚ñ≤ 0%</span>
                <span class="metric-sub">% cubierto</span>
              </div>
              <div class="metric-row danger">
                <span class="metric-down" id="adv-kpi-egi-pend">‚ñº 0</span>
                <span class="metric-sub">por analizar</span>
              </div>
            </div>
            <div class="card metric-card" id="adv-card-equipos">
              <div class="metric-title">Equipos cubiertos</div>
              <div class="metric-value" id="adv-kpi-equipos-ok">-</div>
              <div class="metric-total" id="adv-kpi-equipos-total">-</div>
              <div class="metric-row">
                <span class="metric-up" id="adv-kpi-equipos-pct">‚ñ≤ 0%</span>
                <span class="metric-sub">% cubierto</span>
              </div>
              <div class="metric-row danger">
                <span class="metric-down" id="adv-kpi-equipos-pend">‚ñº 0</span>
                <span class="metric-sub">por analizar</span>
              </div>
            </div>
          </div>

          <div class="card" style="margin-top: 1rem;">
            <div class="dash-adv-toolbar">
              <div class="section-title">An√°lisis por dimensi√≥n</div>
              <div class="dash-tabs" id="dash-adv-tabs">
                <button class="dash-tab active" data-dim="GERENCIA">Gerencia</button>
                <button class="dash-tab" data-dim="SUPERINTENDENCIA">Superintendencia</button>
                <button class="dash-tab" data-dim="UNIDADPROCESO">UnidadProceso</button>
                <button class="dash-tab" data-dim="FLEET">Fleet</button>
                <button class="dash-tab" data-dim="PROCESO">ProcesoSistema</button>
                <button class="dash-tab" data-dim="EGI">EGI</button>
              </div>
            </div>
          </div>

          <div class="grid dash-adv-grid" style="margin-top: 1rem;">
            <div class="card">
              <div class="section-title">Cobertura %</div>
              <div class="chart-center adv-chart">
                <div class="adv-scroll">
                  <canvas id="adv-coverage-chart"></canvas>
                </div>
                <div class="adv-axis" aria-hidden="true">
                  <span>0%</span>
                  <span>20%</span>
                  <span>40%</span>
                  <span>60%</span>
                  <span>80%</span>
                  <span>100%</span>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="section-title">Criticidad</div>
              <div class="chart-center adv-chart">
                <canvas id="adv-criticidad-chart"></canvas>
              </div>
              <div class="classif-legend" id="adv-criticidad-legend"></div>
            </div>
            <div class="card">
              <div class="section-title">Alta criticidad</div>
              <div class="chart-center adv-chart adv-scroll">
                <canvas id="adv-alta-chart"></canvas>
              </div>
            </div>
            <div class="card">
              <div class="section-title">Evoluci√≥n mensual</div>
              <div class="chart-center adv-chart">
                <canvas id="adv-trend-chart"></canvas>
              </div>
            </div>
          </div>

          <div class="card" style="margin-top: 1rem;">
            <div class="toolbar tight" style="margin-bottom: 0.6rem;">
              <span class="muted" id="dash-eval-count"></span>
              <div class="spacer"></div>
              <div class="inline">
                <button class="btn" id="dash-eval-prev" aria-label="P√°gina anterior">¬´</button>
                <input id="dash-eval-page" type="number" min="1" class="page-input" />
                <span class="muted" id="dash-eval-page-total"></span>
                <button class="btn" id="dash-eval-next" aria-label="P√°gina siguiente">¬ª</button>
                <button class="btn" id="refresh-dashboard">Actualizar</button>
              </div>
            </div>
            <div id="tabla-ultimas" class="stack"></div>
          </div>
        </section>

        <div class="modal-backdrop" id="criticidad-modal" aria-hidden="true">
          <div class="modal" role="dialog" aria-modal="true" aria-labelledby="criticidad-modal-title">
            <div class="modal-header">
              <div class="modal-title" id="criticidad-modal-title">Matriz de criticidad</div>
              <button class="icon-btn" type="button" id="criticidad-modal-close" aria-label="Cerrar">√ó</button>
            </div>
            <div class="modal-body">
              <div class="matrix-wrap">
                <img class="matrix-img" id="criticidad-matrix-img" alt="Matriz de criticidad" />
              </div>
            </div>
          </div>
        </div>

        <section id="view-wizard" class="view">
          <div class="card">
            <div class="stepper" id="wizard-steps">
              <div class="step active">1. Nivel</div>
              <div class="step">2. Selecci√≥n</div>
              <div class="step">3. Escenario</div>
              <div class="step">4. Criterios</div>
              <div class="step">5. Confirmar</div>
            </div>

            <div id="wizard-error" class="alert error hidden"></div>

            <div id="step-1" class="stack">
              <div class="target-row">
                <div>
                  <label>Nivel a analizar</label>
                  <select id="nivel-select" class="form-select">
                    <option value="">Seleccione...</option>
                    <option value="Fleet">Fleet</option>
                    <option value="ProcesoSistema">ProcesoSistema</option>
                    <option value="EGI">EGI</option>
                    <option value="Equipo">Equipo</option>
                  </select>
                </div>
                <button class="btn primary" id="to-step-2" disabled>Continuar</button>
              </div>
            </div>

            <div id="step-2" class="stack hidden">
              <div class="step-header">
                <div class="section-title">Filtros</div>
                <div class="target-summary" id="target-summary"></div>
                <div class="spacer"></div>
                <div class="step-actions">
                  <button class="btn" id="back-step-1">Atr√°s</button>
                  <button class="btn primary" id="to-step-3" disabled>Continuar</button>
                </div>
              </div>
              <div class="row filters-row">
                <div class="w-3">
                  <label>Fleet</label>
                  <select id="sel-fleet" class="form-select"></select>
                </div>
                <div class="w-3">
                  <label>ProcesoSistema</label>
                  <select id="sel-proceso" class="form-select"></select>
                </div>
                <div class="w-3">
                  <label>EGI</label>
                  <select id="sel-egi" class="form-select"></select>
                </div>
                <div class="w-3 filter-actions">
                  <label>&nbsp;</label>
                  <button class="btn icon" id="reset-filters" aria-label="Limpiar filtros" title="Limpiar filtros">‚úï</button>
                </div>
              </div>

              <div id="equipo-search" class="stack hidden">
                <div>
                  <label>Buscar equipo</label>
                  <input id="txt-equipo" placeholder="Buscar por EquipNo o NombreEquipo" />
                </div>
                <div id="equipo-existente" class="alert warning hidden">
                  <div class="inline" style="justify-content:space-between; width:100%;">
                    <div>
                      <strong>Este equipo ya fue analizado</strong>
                      <div class="muted" id="equipo-existente-info">-</div>
                    </div>
                    <button class="btn" id="ver-evaluacion-existente">Ver an√°lisis</button>
                  </div>
                </div>
                <div class="toolbar">
                  <span class="muted" id="equipo-count"></span>
                  <div class="spacer"></div>
                  <div class="inline">
                    <button class="btn" id="equipo-prev" aria-label="P√°gina anterior">¬´</button>
                    <input id="equipo-page" type="number" min="1" class="page-input" />
                    <span class="muted" id="equipo-page-total"></span>
                    <button class="btn" id="equipo-next" aria-label="P√°gina siguiente">¬ª</button>
                  </div>
                </div>
                <div id="equipo-results" class="list"></div>
              </div>

            </div>

            <div id="step-3" class="stack hidden">
              <div class="step-header">
                <div class="section-title">Seleccione un escenario</div>
                <div class="spacer"></div>
                <div class="step-actions">
                  <button class="btn" id="back-step-2">Atr√°s</button>
                  <button class="btn primary" id="to-step-4" disabled>Continuar</button>
                </div>
              </div>
              <div class="muted">Debe seleccionar un escenario para continuar con el an√°lisis de criticidad.</div>
              <div class="muted">Equipos cubiertos (jerarqu√≠a): <span id="equipo-count-target">-</span></div>
              <div>
                <label>Buscar escenario</label>
                <input id="escenario-search" placeholder="Buscar por c√≥digo o texto" />
              </div>
              <div class="toolbar">
                <span class="muted" id="escenario-count"></span>
                <div class="spacer"></div>
                <div class="inline">
                  <button class="btn" id="escenario-prev" aria-label="P√°gina anterior">¬´</button>
                  <input id="escenario-page" type="number" min="1" class="page-input" />
                  <span class="muted" id="escenario-page-total"></span>
                  <button class="btn" id="escenario-next" aria-label="P√°gina siguiente">¬ª</button>
                </div>
              </div>
              <div id="escenario-list" class="list"></div>
              <div>
                <div class="section-title">Escenario seleccionado</div>
                <div class="muted" id="escenario-meta">-</div>
              </div>
              <div>
                <label>Evento analizado (solo lectura)</label>
                <textarea id="evento-analizado" readonly></textarea>
              </div>
            </div>

            <div id="step-4" class="stack hidden">
              <div class="step-header">
                <div class="section-title">Responda los 10 criterios para obtener el nivel de criticidad</div>
                <div class="spacer"></div>
                <div class="step-actions">
                  <button class="btn" id="back-step-3">Atr√°s</button>
                  <button class="btn primary" id="to-step-5">Continuar</button>
                </div>
              </div>
              <div id="coverage-summary-step4"></div>
              <div class="grid preguntas-grid" id="preguntas"></div>
              <div>
                <label>Evento analizado (editable)</label>
                <textarea id="evento-analizado-edit" placeholder="Describa o ajuste el evento"></textarea>
              </div>
              <div>
                <label>Justificaci√≥n (obligatorio)</label>
                <textarea id="justificacion" placeholder="Describa la justificaci√≥n"></textarea>
              </div>
            </div>

            <div id="step-5" class="stack hidden">
              <div class="step-header">
                <div class="section-title">Resumen</div>
                <div class="spacer"></div>
                <div class="step-actions">
                  <button class="btn" id="back-step-4">Atr√°s</button>
                  <button class="btn primary" id="confirmar">Confirmar y enviar</button>
                </div>
              </div>
              <div id="resumen"></div>
            </div>

            <div id="step-6" class="stack hidden">
              <div class="alert success">An√°lisis de criticidad guardado correctamente.</div>
              <div>
                <button class="btn" id="nueva-otra">Nuevo an√°lisis de criticidad</button>
              </div>
            </div>
          </div>
        </section>

        <section id="view-mis" class="view">
          <div class="card">
            <div class="toolbar">
              <div class="section-title">Mis An√°lisis</div>
              <div class="spacer"></div>
              <button class="btn" id="refresh-mis">Actualizar</button>
            </div>
            <div class="row mis-dates">
              <div>
                <label>Fecha desde</label>
                <input type="date" id="mis-desde" />
              </div>
              <div>
                <label>Fecha hasta</label>
                <input type="date" id="mis-hasta" />
              </div>
            </div>
            <div class="row eval-filters">
              <div>
                <label>Equipo</label>
                <input id="mis-equipo" placeholder="EquipNo o Target" />
              </div>
              <div>
                <label>Fleet</label>
                <select id="mis-fleet" class="form-select"></select>
              </div>
              <div>
                <label>ProcesoSistema</label>
                <select id="mis-proceso" class="form-select"></select>
              </div>
              <div>
                <label>EGI</label>
                <select id="mis-egi" class="form-select"></select>
              </div>
            </div>
            <div class="toolbar" style="margin-bottom: 0.6rem;">
              <span class="muted" id="mis-eval-count"></span>
              <div class="spacer"></div>
              <div class="inline">
                <button class="btn" id="mis-eval-prev" aria-label="P√°gina anterior">¬´</button>
                <input id="mis-eval-page" type="number" min="1" class="page-input" />
                <span class="muted" id="mis-eval-page-total"></span>
                <button class="btn" id="mis-eval-next" aria-label="P√°gina siguiente">¬ª</button>
              </div>
            </div>
            <div id="mis-list" class="stack"></div>
          </div>
        </section>

        <section id="view-all" class="view">
          <div class="card">
            <div class="toolbar">
              <div class="section-title">Todos los an√°lisis</div>
              <div class="spacer"></div>
              <button class="btn" id="all-eval-refresh">Actualizar</button>
            </div>
            <div class="row mis-dates">
              <div>
                <label>Fecha desde</label>
                <input type="date" id="all-desde" />
              </div>
              <div>
                <label>Fecha hasta</label>
                <input type="date" id="all-hasta" />
              </div>
            </div>
            <div class="row eval-filters">
              <div>
                <label>Equipo</label>
                <input id="all-equipo" placeholder="EquipNo o Target" />
              </div>
              <div>
                <label>Fleet</label>
                <select id="all-fleet" class="form-select"></select>
              </div>
              <div>
                <label>ProcesoSistema</label>
                <select id="all-proceso" class="form-select"></select>
              </div>
              <div>
                <label>EGI</label>
                <select id="all-egi" class="form-select"></select>
              </div>
            </div>
            <div class="toolbar" style="margin-bottom: 0.6rem;">
              <span class="muted" id="all-eval-count"></span>
              <div class="spacer"></div>
              <div class="inline">
                <button class="btn" id="all-eval-prev" aria-label="P√°gina anterior">¬´</button>
                <input id="all-eval-page" type="number" min="1" class="page-input" />
                <span class="muted" id="all-eval-page-total"></span>
                <button class="btn" id="all-eval-next" aria-label="P√°gina siguiente">¬ª</button>
              </div>
            </div>
            <div id="all-eval-list" class="stack"></div>
          </div>
        </section>

        <section id="view-admin" class="view">
          <div class="card">
            <div class="toolbar">
              <div class="section-title">Solicitudes de edici√≥n</div>
              <div class="spacer"></div>
              <button class="btn" id="admin-req-refresh">Actualizar</button>
            </div>
            <div class="muted" id="admin-req-count">-</div>
            <div id="admin-req-list" class="stack"></div>
          </div>
          <div class="card">
            <div class="toolbar">
              <div class="section-title">Admin - Escenarios</div>
              <div class="spacer"></div>
              <button class="btn primary" id="admin-nuevo">Nuevo escenario</button>
            </div>
            <div class="row" style="margin: 0.8rem 0 1rem;">
              <div class="w-3">
                <label>NivelAplicacion</label>
                <select id="admin-nivel" class="form-select"></select>
              </div>
              <div class="w-3">
                <label>Fleet</label>
                <select id="admin-fleet" class="form-select"></select>
              </div>
              <div class="w-3">
                <label>ProcesoSistema</label>
                <select id="admin-proceso" class="form-select"></select>
              </div>
              <div class="w-3">
                <label>EGI</label>
                <select id="admin-egi" class="form-select"></select>
              </div>
            </div>
            <div id="admin-list" class="stack"></div>
          </div>

          <div class="card" style="margin-top: 1rem;">
            <div class="toolbar">
              <div class="section-title">Admin - An√°lisis</div>
              <div class="spacer"></div>
              <button class="btn" id="admin-eval-refresh">Actualizar</button>
            </div>
            <div class="row" style="margin: 0.8rem 0 1rem;">
              <div class="w-3">
                <label>Buscar (Title o EquipNo)</label>
                <input id="admin-eval-term" placeholder="EVAL-... o EquipNo" />
              </div>
              <div class="w-3">
                <label>Fecha desde</label>
                <input type="date" id="admin-eval-desde" />
              </div>
              <div class="w-3">
                <label>Fecha hasta</label>
                <input type="date" id="admin-eval-hasta" />
              </div>
            </div>
            <div class="toolbar" style="margin-bottom: 0.6rem;">
              <span class="muted" id="admin-eval-count"></span>
              <div class="spacer"></div>
              <div class="inline">
                <button class="btn" id="admin-eval-prev" aria-label="P√°gina anterior">¬´</button>
                <input id="admin-eval-page" type="number" min="1" class="page-input" />
                <span class="muted" id="admin-eval-page-total"></span>
                <button class="btn" id="admin-eval-next" aria-label="P√°gina siguiente">¬ª</button>
              </div>
            </div>
            <div id="admin-eval-list" class="stack"></div>
          </div>

        </section>

        <section id="view-evaluacion" class="view">
          <div class="card">
            <div class="toolbar">
              <div class="section-title" id="eval-detalle-title">An√°lisis</div>
              <div class="spacer"></div>
              <button class="btn" id="eval-request-edit">Solicitar edici√≥n</button>
              <button class="btn" id="eval-edit-start">Editar</button>
              <button class="btn" id="eval-back">Volver</button>
            </div>
            <div id="eval-detalle-meta" class="stack"></div>
          </div>
          <div class="card hidden" style="margin-top: 1rem;" id="eval-edit-card">
            <div class="section-title">Editar an√°lisis</div>
            <div class="grid preguntas-grid" id="eval-edit-preguntas"></div>
            <div>
              <label>Evento analizado</label>
              <textarea id="eval-edit-evento"></textarea>
            </div>
            <div>
              <label>Justificaci√≥n</label>
              <textarea id="eval-edit-justificacion"></textarea>
            </div>
            <div class="toolbar">
              <button class="btn" id="eval-edit-cancel">Cancelar</button>
              <div class="spacer"></div>
              <button class="btn primary" id="eval-edit-save">Guardar cambios</button>
            </div>
          </div>
          <div class="card" style="margin-top: 1rem;">
            <div class="section-title">Equipos asociados</div>
            <div class="row eval-filters">
              <div class="w-3">
                <label>Equipo</label>
                <input id="eval-filter-equipo" placeholder="EquipNo o Nombre" />
              </div>
              <div class="w-3">
                <label>Fleet</label>
                <select id="eval-filter-fleet" class="form-select"></select>
              </div>
              <div class="w-3">
                <label>Proceso</label>
                <select id="eval-filter-proceso" class="form-select"></select>
              </div>
              <div class="w-3">
                <label>EGI</label>
                <select id="eval-filter-egi" class="form-select"></select>
              </div>
            </div>
            <div class="toolbar">
              <span class="muted" id="eval-equipos-count">-</span>
              <div class="spacer"></div>
              <button class="btn" id="eval-equipos-prev">¬´</button>
              <input id="eval-equipos-page" class="page-input" value="1" />
              <span class="muted" id="eval-equipos-pages">/ 1</span>
              <button class="btn" id="eval-equipos-next">¬ª</button>
            </div>
            <div id="eval-equipos-table"></div>
          </div>
        </section>

        <div class="footer">AC - Activos del sitio</div>
      </div>
    </main>
  </div>

  <script src="js/spHttp.js"></script>
  <script src="js/catalogService.js"></script>
  <script src="js/scenarioService.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="js/matrixModal.js"></script>
  <script src="js/app.js"></script>
</body>
</html><!DOCTYPE html>
<html lang="es">
            <defs>
              <linearGradient id="spark-grad-equipos" x1="0" x2="0" y1="0" y2="1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AC - Analisis</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  <link rel="stylesheet" href="css/style.css" />
            <path class="area" fill="url(#spark-grad-equipos)" d="M2 30 C 18 20, 34 28, 50 18 S 82 12, 118 6 L118 40 L2 40 Z" />
<body>
  <div class="loading-overlay" id="loading-overlay">
    <div class="loading-card">
      <div class="spinner"></div>
      <div class="loading-text">Cargando informaci√≥n...</div>
    </div>
  </div>
  <div class="app-shell">
    <aside class="sidebar">
      <div class="brand">
        <div class="brand-mark">AC</div>
        <div class="brand-text">
          <div class="brand-title">Analisis</div>
          <div class="brand-sub">Activos del sitio</div>
        </div>
      </div>
      <nav class="side-nav">
        <button class="btn side-btn active" id="nav-dashboard" data-view="view-dashboard">
          <svg class="nav-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 10.5 12 3l9 7.5V21a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1V10.5z"/></svg>
          Inicio
        </button>
        <button class="btn side-btn" id="nav-dashboard-advanced" data-view="view-dashboard-advanced">
          <svg class="nav-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M4 6h16M4 12h10M4 18h7"/></svg>
          Dashboard
        </button>
        <button class="btn side-btn primary" id="nav-wizard" data-view="view-wizard">
          <svg class="nav-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M6 2h9l5 5v15a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm8 1.5V8h4.5"/></svg>
          Nuevo Analisis
        </button>
        <button class="btn side-btn" id="nav-mis" data-view="view-mis">
          <svg class="nav-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4zm0 2c-4.4 0-8 2-8 4.5V21h16v-2.5C20 16 16.4 14 12 14z"/></svg>
          Mis Analisis
        </button>
        <button class="btn side-btn" id="nav-all" data-view="view-all">
          <svg class="nav-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M16 11a3 3 0 1 0-3-3 3 3 0 0 0 3 3zM8 11a3 3 0 1 0-3-3 3 3 0 0 0 3 3zm8 2c-2.7 0-5 1.3-5 3v2h10v-2c0-1.7-2.3-3-5-3zM8 13c-2.7 0-5 1.3-5 3v2h7v-2c0-1.7-1-3-2-3z"/></svg>
          Todos los Analisis
        </button>
        <button class="btn side-btn hidden" id="nav-admin" data-view="view-admin">
          <svg class="nav-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2a2 2 0 0 1 2 2v1.1a7 7 0 0 1 2.7 1.1l.8-.8a2 2 0 1 1 2.8 2.8l-.8.8A7 7 0 0 1 19 12a7 7 0 0 1-1.1 3.7l.8.8a2 2 0 1 1-2.8 2.8l-.8-.8A7 7 0 0 1 12 19a7 7 0 0 1-3.7-1.1l-.8.8a2 2 0 1 1-2.8-2.8l.8-.8A7 7 0 0 1 5 12a7 7 0 0 1 1.1-3.7l-.8-.8a2 2 0 1 1 2.8-2.8l.8.8A7 7 0 0 1 12 5.1V4a2 2 0 0 1 2-2z"/></svg>
          Admin
        </button>
      </nav>
    </aside>
    <main class="main">
      <div class="topbar">
        <div class="topbar-inner">
            <defs>
              <linearGradient id="spark-grad-procesos" x1="0" x2="0" y1="0" y2="1">
            <div class="top-sub" id="page-subtitle">Resumen general</div>
          </div>
          <div class="topbar-actions">
            <div class="user-card">
              <div class="user-avatar" id="user-avatar">
            <path class="area" fill="url(#spark-grad-procesos)" d="M2 30 C 18 20, 34 28, 50 18 S 82 12, 118 6 L118 40 L2 40 Z" />
                <span id="user-initials">AC</span>
              </div>
              <div class="user-meta">
                <div class="user-name" id="user-name">Usuario</div>
                <div class="user-email" id="user-email">-</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="container">
    <section id="view-dashboard" class="view active">
      <div class="grid kpi kpi-tiles">
        <div class="card metric-card" id="card-flotas">
          <div class="metric-title">Flotas cubiertas</div>
          <div class="metric-value" id="kpi-hoy">-</div>
          <div class="metric-total" id="kpi-flotas-total">-</div>
          <div class="metric-row">
            <span class="metric-up" id="kpi-flotas-pct">‚ñ≤ 0%</span>
            <span class="metric-sub">% cubierto</span>
          </div>
          <div class="metric-row danger">
            <span class="metric-down" id="kpi-flotas-pend">‚ñº 0</span>
            <span class="metric-sub">por analizar</span>
          </div>
          <svg class="spark" viewBox="0 0 120 40" aria-hidden="true">
            <defs>
              <linearGradient id="spark-grad-flotas" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" stop-color="currentColor" stop-opacity="0.35" />
                <stop offset="60%" stop-color="currentColor" stop-opacity="0.08" />
                <stop offset="100%" stop-color="currentColor" stop-opacity="0" />
              </linearGradient>
            </defs>
            <path class="area" fill="url(#spark-grad-flotas)" d="M2 30 C 18 20, 34 28, 50 18 S 82 12, 118 6 L118 40 L2 40 Z" />
            <path class="line" d="M2 30 C 18 20, 34 28, 50 18 S 82 12, 118 6" />
          </svg>
        </div>
        <div class="card metric-card" id="card-equipos">
          <div class="metric-title">Equipos cubiertos</div>
          <div class="metric-value" id="kpi-equipos-cubiertos">-</div>
          <div class="metric-total" id="kpi-equipos-total">-</div>
          <div class="metric-row">
            <span class="metric-up" id="kpi-equipos-pct">‚ñ≤ 0%</span>
            <span class="metric-sub">% cubierto</span>
          </div>
          <div class="metric-row danger">
            <span class="metric-down" id="kpi-equipos-pend">‚ñº 0</span>
            <span class="metric-sub">por analizar</span>
          </div>
          <svg class="spark" viewBox="0 0 120 40" aria-hidden="true">
            <defs>
              <linearGradient id="spark-grad-equipos" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" stop-color="currentColor" stop-opacity="0.35" />
                <stop offset="60%" stop-color="currentColor" stop-opacity="0.08" />
                <stop offset="100%" stop-color="currentColor" stop-opacity="0" />
              </linearGradient>
            </defs>
            <path class="area" fill="url(#spark-grad-equipos)" d="M2 28 C 20 18, 38 26, 56 14 S 84 10, 118 8 L118 40 L2 40 Z" />
            <path class="line" d="M2 28 C 20 18, 38 26, 56 14 S 84 10, 118 8" />
          </svg>
        </div>
        <div class="card metric-card" id="card-procesos">
          <div class="metric-title">Procesos cubiertos</div>
          <div class="metric-value" id="kpi-procesos-ok">-</div>
          <div class="metric-total" id="kpi-procesos-total">-</div>
          <div class="metric-row">
            <span class="metric-up" id="kpi-procesos-pct">‚ñ≤ 0%</span>
            <span class="metric-sub">% cubierto</span>
          </div>
          <div class="metric-row danger">
            <span class="metric-down" id="kpi-procesos-pend">‚ñº 0</span>
            <span class="metric-sub">por analizar</span>
          </div>
          <svg class="spark" viewBox="0 0 120 40" aria-hidden="true">
            <defs>
              <linearGradient id="spark-grad-procesos" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" stop-color="currentColor" stop-opacity="0.35" />
                <stop offset="60%" stop-color="currentColor" stop-opacity="0.08" />
                <stop offset="100%" stop-color="currentColor" stop-opacity="0" />
              </linearGradient>
            </defs>
            <path class="area" fill="url(#spark-grad-procesos)" d="M2 32 C 18 24, 38 30, 56 20 S 86 16, 118 12 L118 40 L2 40 Z" />
            <path class="line" d="M2 32 C 18 24, 38 30, 56 20 S 86 16, 118 12" />
          </svg>
        </div>
        <div class="card metric-card" id="card-egis">
          <div class="metric-title">EGI cubiertas</div>
          <div class="metric-value" id="kpi-egi-ok">-</div>
          <div class="metric-total" id="kpi-egi-total">-</div>
          <div class="metric-row">
            <span class="metric-up" id="kpi-egi-pct">‚ñ≤ 0%</span>
            <span class="metric-sub">% cubierto</span>
          </div>
          <div class="metric-row danger">
            <span class="metric-down" id="kpi-egi-pend">‚ñº 0</span>
            <span class="metric-sub">por analizar</span>
          </div>
          <svg class="spark" viewBox="0 0 120 40" aria-hidden="true">
            <defs>
              <linearGradient id="spark-grad-egis" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" stop-color="currentColor" stop-opacity="0.35" />
                <stop offset="60%" stop-color="currentColor" stop-opacity="0.08" />
                <stop offset="100%" stop-color="currentColor" stop-opacity="0" />
              </linearGradient>
            </defs>
            <path class="area" fill="url(#spark-grad-egis)" d="M2 26 C 20 16, 40 24, 58 12 S 90 10, 118 6 L118 40 L2 40 Z" />
            <path class="line" d="M2 26 C 20 16, 40 24, 58 12 S 90 10, 118 6" />
          </svg>
        </div>
      </div>
      <div class="grid dash-bottom" style="margin-top: 1.2rem;">
        <div class="card">
          <div class="section-title">An√°lisis por gerencia (equipos cubiertos)</div>
          <div class="geo-grid">
            <div class="chart-center">
              <canvas id="gerencia-chart"></canvas>
            </div>
          </div>
        </div>
        <div class="card classif-card">
          <div class="section-title">Criticidad</div>
          <div class="chart-center">
            <canvas id="criticidad-chart"></canvas>
          </div>
          <div class="classif-legend" id="criticidad-legend"></div>
        </div>
      </div>
      <div class="card" style="margin-top: 1rem;">
        <div class="toolbar tight" style="margin-bottom: 0.6rem;">
          <span class="muted" id="dash-eval-count"></span>
          <div class="spacer"></div>
          <div class="inline">
            <button class="btn" id="dash-eval-prev" aria-label="P√°gina anterior">¬´</button>
            <input id="dash-eval-page" type="number" min="1" class="page-input" />
            <span class="muted" id="dash-eval-page-total"></span>
            <button class="btn" id="dash-eval-next" aria-label="P√°gina siguiente">¬ª</button>
            <button class="btn" id="refresh-dashboard">Actualizar</button>
          </div>
        </div>
        <div class="stack" id="tabla-ultimas"></div>
      </div>
    </section>

    <section id="view-dashboard-advanced" class="view">
      <div class="grid kpi kpi-tiles">
        <div class="card metric-card" id="adv-card-flotas">
          <div class="metric-title">Flotas cubiertas</div>
          <div class="metric-value" id="adv-kpi-flotas-ok">-</div>
          <div class="metric-total" id="adv-kpi-flotas-total">-</div>
          <div class="metric-row">
            <span class="metric-up" id="adv-kpi-flotas-pct">‚ñ≤ 0%</span>
            <span class="metric-sub">% cubierto</span>
          </div>
          <div class="metric-row danger">
            <span class="metric-down" id="adv-kpi-flotas-pend">‚ñº 0</span>
            <span class="metric-sub">por analizar</span>
          </div>
        </div>
        <div class="card metric-card" id="adv-card-equipos">
          <div class="metric-title">Equipos cubiertos</div>
          <div class="metric-value" id="adv-kpi-equipos-ok">-</div>
          <div class="metric-total" id="adv-kpi-equipos-total">-</div>
          <div class="metric-row">
            <span class="metric-up" id="adv-kpi-equipos-pct">‚ñ≤ 0%</span>
            <span class="metric-sub">% cubierto</span>
          </div>
          <div class="metric-row danger">
            <span class="metric-down" id="adv-kpi-equipos-pend">‚ñº 0</span>
            <span class="metric-sub">por analizar</span>
          </div>
        </div>
        <div class="card metric-card" id="adv-card-procesos">
          <div class="metric-title">Procesos cubiertos</div>
          <div class="metric-value" id="adv-kpi-procesos-ok">-</div>
          <div class="metric-total" id="adv-kpi-procesos-total">-</div>
          <div class="metric-row">
            <span class="metric-up" id="adv-kpi-procesos-pct">‚ñ≤ 0%</span>
            <span class="metric-sub">% cubierto</span>
          </div>
          <div class="metric-row danger">
            <span class="metric-down" id="adv-kpi-procesos-pend">‚ñº 0</span>
            <span class="metric-sub">por analizar</span>
          </div>
        </div>
        <div class="card metric-card" id="adv-card-egis">
          <div class="metric-title">EGI cubiertas</div>
          <div class="metric-value" id="adv-kpi-egi-ok">-</div>
          <div class="metric-total" id="adv-kpi-egi-total">-</div>
          <div class="metric-row">
            <span class="metric-up" id="adv-kpi-egi-pct">‚ñ≤ 0%</span>
            <span class="metric-sub">% cubierto</span>
          </div>
          <div class="metric-row danger">
            <span class="metric-down" id="adv-kpi-egi-pend">‚ñº 0</span>
            <span class="metric-sub">por analizar</span>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top: 1rem;">
        <div class="dash-adv-toolbar">
          <div class="dash-tabs" id="dash-adv-tabs">
            <button class="dash-tab active" data-dim="GERENCIA">Gerencia</button>
            <button class="dash-tab" data-dim="SUPERINTENDENCIA">Superintendencia</button>
            <button class="dash-tab" data-dim="UNIDADPROCESO">UnidadProceso</button>
            <button class="dash-tab" data-dim="FLEET">Fleet</button>
            <button class="dash-tab" data-dim="PROCESO">ProcesoSistema</button>
          </div>
          <div class="dash-filter">
            <label>Filtro</label>
            <select id="dash-adv-filter" class="form-select"></select>
          </div>
        </div>
      </div>

      <div class="grid dash-adv-grid" style="margin-top: 1rem;">
        <div class="card">
          <div class="section-title">Cobertura %</div>
          <div class="chart-center adv-chart">
            <canvas id="adv-coverage-chart"></canvas>
          </div>
        </div>
        <div class="card">
          <div class="section-title">Criticidad</div>
          <div class="chart-center adv-chart">
            <canvas id="adv-criticidad-chart"></canvas>
          </div>
          <div class="classif-legend" id="adv-criticidad-legend"></div>
        </div>
        <div class="card">
          <div class="section-title">Top 5 Alta criticidad</div>
          <div class="chart-center adv-chart">
            <canvas id="adv-alta-chart"></canvas>
          </div>
        </div>
        <div class="card">
          <div class="section-title">Evoluci√≥n mensual</div>
          <div class="chart-center adv-chart">
            <canvas id="adv-trend-chart"></canvas>
          </div>
        </div>
      </div>
    </section>

    <div class="modal-backdrop" id="criticidad-modal" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="criticidad-modal-title">
        <div class="modal-header">
          <div class="modal-title" id="criticidad-modal-title">Matriz de criticidad</div>
          <button class="icon-btn" type="button" id="criticidad-modal-close" aria-label="Cerrar">√ó</button>
        </div>
        <div class="modal-body">
          <div class="matrix-wrap">
            <img class="matrix-img" id="criticidad-matrix-img" alt="Matriz de criticidad" />
          </div>
        </div>
      </div>
    </div>

    <section id="view-wizard" class="view">
      <div class="card">
        <div class="stepper" id="wizard-steps">
          <div class="step active">1. Nivel</div>
          <div class="step">2. Selecci√≥n</div>
          <div class="step">3. Escenario</div>
          <div class="step">4. Preguntas</div>
          <div class="step">5. Confirmar</div>
        </div>

        <div id="wizard-error" class="alert error hidden"></div>

        <div id="step-1" class="stack">
          <div class="target-row">
            <div>
              <label>Nivel a analizar</label>
              <select id="nivel-select" class="form-select">
                <option value="">Seleccione...</option>
                <option value="Fleet">Fleet</option>
                <option value="ProcesoSistema">ProcesoSistema</option>
                <option value="EGI">EGI</option>
                <option value="Equipo">Equipo</option>
              </select>
            </div>
            <button class="btn primary" id="to-step-2" disabled>Continuar</button>
          </div>
        </div>

        <div id="step-2" class="stack hidden">
          <div class="step-header">
            <div class="section-title">Filtros</div>
            <div class="target-summary" id="target-summary"></div>
            <div class="spacer"></div>
            <div class="step-actions">
              <button class="btn" id="back-step-1">Atr√°s</button>
              <button class="btn primary" id="to-step-3" disabled>Continuar</button>
            </div>
          </div>
          <div class="row filters-row">
            <div class="w-3">
              <label>Fleet</label>
              <select id="sel-fleet" class="form-select"></select>
            </div>
            <div class="w-3">
              <label>ProcesoSistema</label>
              <select id="sel-proceso" class="form-select"></select>
            </div>
            <div class="w-3">
              <label>EGI</label>
              <select id="sel-egi" class="form-select"></select>
            </div>
            <div class="w-3 filter-actions">
              <label>&nbsp;</label>
              <button class="btn icon" id="reset-filters" aria-label="Limpiar filtros" title="Limpiar filtros">‚úï</button>
            </div>
          </div>

          <div id="equipo-search" class="stack hidden">
            <div>
              <label>Buscar equipo</label>
              <input id="txt-equipo" placeholder="Buscar por EquipNo o NombreEquipo" />
            </div>
            <div id="equipo-existente" class="alert warning hidden">
              <div class="inline" style="justify-content:space-between; width:100%;">
                <div>
                  <strong>Este equipo ya fue analizado</strong>
                  <div class="muted" id="equipo-existente-info">-</div>
                </div>
                <button class="btn" id="ver-evaluacion-existente">Ver An√°lisis</button>
              </div>
            </div>
            <div class="toolbar">
              <span class="muted" id="equipo-count"></span>
              <div class="spacer"></div>
              <div class="inline">
                <button class="btn" id="equipo-prev" aria-label="P√°gina anterior">¬´</button>
                <input id="equipo-page" type="number" min="1" class="page-input" />
                <span class="muted" id="equipo-page-total"></span>
                <button class="btn" id="equipo-next" aria-label="P√°gina siguiente">¬ª</button>
              </div>
            </div>
            <div id="equipo-results" class="list"></div>
          </div>

        </div>

        <div id="step-3" class="stack hidden">
          <div class="step-header">
            <div class="section-title">Seleccione un escenario</div>
            <div class="spacer"></div>
            <div class="step-actions">
              <button class="btn" id="back-step-2">Atr√°s</button>
              <button class="btn primary" id="to-step-4" disabled>Continuar</button>
            </div>
          </div>
          <div class="muted">Debe seleccionar un escenario para continuar con el An√°lisis.</div>
          <div class="muted">Equipos cubiertos (jerarqu√≠a): <span id="equipo-count-target">-</span></div>
          <div>
            <label>Buscar escenario</label>
            <input id="escenario-search" placeholder="Buscar por c√≥digo o texto" />
          </div>
          <div class="toolbar">
            <span class="muted" id="escenario-count"></span>
            <div class="spacer"></div>
            <div class="inline">
              <button class="btn" id="escenario-prev" aria-label="P√°gina anterior">¬´</button>
              <input id="escenario-page" type="number" min="1" class="page-input" />
              <span class="muted" id="escenario-page-total"></span>
              <button class="btn" id="escenario-next" aria-label="P√°gina siguiente">¬ª</button>
            </div>
          </div>
          <div id="escenario-list" class="list"></div>
          <div>
            <div class="section-title">Escenario seleccionado</div>
            <div class="muted" id="escenario-meta">-</div>
          </div>
          <div>
            <label>Evento analizado (solo lectura)</label>
            <textarea id="evento-analizado" readonly></textarea>
          </div>
        </div>

        <div id="step-4" class="stack hidden">
          <div class="step-header">
            <div class="section-title">Responda las 10 preguntas</div>
            <div class="spacer"></div>
            <div class="step-actions">
              <button class="btn" id="back-step-3">Atr√°s</button>
              <button class="btn primary" id="to-step-5">Continuar</button>
            </div>
          </div>
          <div id="coverage-summary-step4"></div>
          <div class="grid preguntas-grid" id="preguntas"></div>
          <div>
            <label>Evento analizado (editable)</label>
            <textarea id="evento-analizado-edit" placeholder="Describa o ajuste el evento"></textarea>
          </div>
          <div>
            <label>Justificaci√≥n (obligatorio)</label>
            <textarea id="justificacion" placeholder="Describa la justificaci√≥n"></textarea>
          </div>
        </div>

        <div id="step-5" class="stack hidden">
          <div class="step-header">
            <div class="section-title">Resumen</div>
            <div class="spacer"></div>
            <div class="step-actions">
              <button class="btn" id="back-step-4">Atr√°s</button>
              <button class="btn primary" id="confirmar">Confirmar y enviar</button>
            </div>
          </div>
          <div id="resumen"></div>
        </div>

        <div id="step-6" class="stack hidden">
          <div class="alert success">An√°lisis de criticidad guardada correctamente.</div>
          <div>
            <button class="btn" id="nueva-otra">Nuevo an√°lisis de criticidad</button>
          </div>
        </div>
      </div>
    </section>

    <section id="view-mis" class="view">
      <div class="card">
        <div class="toolbar">
          <div class="section-title">Mis An√°lisis</div>
          <div class="spacer"></div>
          <button class="btn" id="refresh-mis">Actualizar</button>
        </div>
        <div class="row mis-dates">
          <div>
            <label>Fecha desde</label>
            <input type="date" id="mis-desde" />
          </div>
          <div>
            <label>Fecha hasta</label>
            <input type="date" id="mis-hasta" />
          </div>
        </div>
        <div class="row eval-filters">
          <div>
            <label>Equipo</label>
            <input id="mis-equipo" placeholder="EquipNo o Target" />
          </div>
          <div>
            <label>Fleet</label>
            <select id="mis-fleet" class="form-select"></select>
          </div>
          <div>
            <label>ProcesoSistema</label>
            <select id="mis-proceso" class="form-select"></select>
          </div>
          <div>
            <label>EGI</label>
            <select id="mis-egi" class="form-select"></select>
          </div>
        </div>
        <div class="toolbar" style="margin-bottom: 0.6rem;">
          <span class="muted" id="mis-eval-count"></span>
          <div class="spacer"></div>
          <div class="inline">
            <button class="btn" id="mis-eval-prev" aria-label="P√°gina anterior">¬´</button>
            <input id="mis-eval-page" type="number" min="1" class="page-input" />
            <span class="muted" id="mis-eval-page-total"></span>
            <button class="btn" id="mis-eval-next" aria-label="P√°gina siguiente">¬ª</button>
          </div>
        </div>
        <div id="mis-list" class="stack"></div>
      </div>
    </section>

    <section id="view-all" class="view">
      <div class="card">
        <div class="toolbar">
          <div class="section-title">Todos los analisis</div>
          <div class="spacer"></div>
          <button class="btn" id="all-eval-refresh">Actualizar</button>
        </div>
        <div class="row mis-dates">
          <div>
            <label>Fecha desde</label>
            <input type="date" id="all-desde" />
          </div>
          <div>
            <label>Fecha hasta</label>
            <input type="date" id="all-hasta" />
          </div>
        </div>
        <div class="row eval-filters">
          <div>
            <label>Equipo</label>
            <input id="all-equipo" placeholder="EquipNo o Target" />
          </div>
          <div>
            <label>Fleet</label>
            <select id="all-fleet" class="form-select"></select>
          </div>
          <div>
            <label>ProcesoSistema</label>
            <select id="all-proceso" class="form-select"></select>
          </div>
          <div>
            <label>EGI</label>
            <select id="all-egi" class="form-select"></select>
          </div>
        </div>
        <div class="toolbar" style="margin-bottom: 0.6rem;">
          <span class="muted" id="all-eval-count"></span>
          <div class="spacer"></div>
          <div class="inline">
            <button class="btn" id="all-eval-prev" aria-label="P√°gina anterior">¬´</button>
            <input id="all-eval-page" type="number" min="1" class="page-input" />
            <span class="muted" id="all-eval-page-total"></span>
            <button class="btn" id="all-eval-next" aria-label="P√°gina siguiente">¬ª</button>
          </div>
        </div>
        <div id="all-eval-list" class="stack"></div>
      </div>
    </section>

    <section id="view-admin" class="view">
      <div class="card">
        <div class="toolbar">
          <div class="section-title">Solicitudes de edici√≥n</div>
          <div class="spacer"></div>
          <button class="btn" id="admin-req-refresh">Actualizar</button>
        </div>
        <div class="muted" id="admin-req-count">-</div>
        <div id="admin-req-list" class="stack"></div>
      </div>
      <div class="card">
        <div class="toolbar">
          <div class="section-title">Admin - Escenarios</div>
          <div class="spacer"></div>
          <button class="btn primary" id="admin-nuevo">Nuevo escenario</button>
        </div>
        <div class="row" style="margin: 0.8rem 0 1rem;">
          <div class="w-3">
            <label>NivelAplicacion</label>
            <select id="admin-nivel" class="form-select"></select>
          </div>
          <div class="w-3">
            <label>Fleet</label>
            <select id="admin-fleet" class="form-select"></select>
          </div>
          <div class="w-3">
            <label>ProcesoSistema</label>
            <select id="admin-proceso" class="form-select"></select>
          </div>
          <div class="w-3">
            <label>EGI</label>
            <select id="admin-egi" class="form-select"></select>
          </div>
        </div>
        <div id="admin-list" class="stack"></div>
      </div>

      <div class="card" style="margin-top: 1rem;">
        <div class="toolbar">
          <div class="section-title">Admin - An√°lisis</div>
          <div class="spacer"></div>
          <button class="btn" id="admin-eval-refresh">Actualizar</button>
        </div>
        <div class="row" style="margin: 0.8rem 0 1rem;">
          <div class="w-3">
            <label>Buscar (Title o EquipNo)</label>
            <input id="admin-eval-term" placeholder="EVAL-... o EquipNo" />
          </div>
          <div class="w-3">
            <label>Fecha desde</label>
            <input type="date" id="admin-eval-desde" />
          </div>
          <div class="w-3">
            <label>Fecha hasta</label>
            <input type="date" id="admin-eval-hasta" />
          </div>
        </div>
        <div class="toolbar" style="margin-bottom: 0.6rem;">
          <span class="muted" id="admin-eval-count"></span>
          <div class="spacer"></div>
          <div class="inline">
            <button class="btn" id="admin-eval-prev" aria-label="P√°gina anterior">¬´</button>
            <input id="admin-eval-page" type="number" min="1" class="page-input" />
            <span class="muted" id="admin-eval-page-total"></span>
            <button class="btn" id="admin-eval-next" aria-label="P√°gina siguiente">¬ª</button>
          </div>
        </div>
        <div id="admin-eval-list" class="stack"></div>
      </div>

      <div class="card hidden" style="margin-top: 1rem;" id="admin-editor">
        <div class="section-title" id="admin-editor-title">Nuevo escenario</div>
        <div class="stack">
          <div class="row">
            <div class="w-4">
              <label>Title</label>
              <input id="sc-title" />
            </div>
            <div class="w-3">
              <label>Activo</label>
              <select id="sc-activo" class="form-select">
                <option value="1">S√≠</option>
                <option value="0">No</option>
              </select>
            </div>
            <div class="w-3">
              <label>NivelAplicacion</label>
              <select id="sc-nivel" class="form-select"></select>
            </div>
          </div>
          <div class="row">
            <div class="w-3">
              <label>Fleet</label>
              <input id="sc-fleet" />
            </div>
            <div class="w-3">
              <label>ProcesoSistema</label>
              <input id="sc-proceso" />
            </div>
            <div class="w-3">
              <label>EGI</label>
              <input id="sc-egi" />
            </div>
            <div class="w-3">
              <label>EquipNo</label>
              <input id="sc-equipno" />
            </div>
          </div>
          <div>
            <label>EventoAnalizado</label>
            <textarea id="sc-evento"></textarea>
          </div>
        </div>
        <div class="toolbar">
          <button class="btn" id="admin-cancelar">Cancelar</button>
          <div class="spacer"></div>
          <button class="btn primary" id="admin-guardar">Guardar</button>
        </div>
      </div>
    </section>

    <section id="view-evaluacion" class="view">
      <div class="card">
        <div class="toolbar">
          <div class="section-title" id="eval-detalle-title">An√°lisis</div>
          <div class="spacer"></div>
          <button class="btn" id="eval-request-edit">Solicitar edici√≥n</button>
          <button class="btn" id="eval-edit-start">Editar</button>
          <button class="btn" id="eval-back">Volver</button>
        </div>
        <div id="eval-detalle-meta" class="stack"></div>
      </div>
      <div class="card hidden" style="margin-top: 1rem;" id="eval-edit-card">
        <div class="section-title">Editar An√°lisis</div>
        <div class="grid preguntas-grid" id="eval-edit-preguntas"></div>
        <div>
          <label>Evento analizado</label>
          <textarea id="eval-edit-evento"></textarea>
        </div>
        <div>
          <label>Justificaci√≥n</label>
          <textarea id="eval-edit-justificacion"></textarea>
        </div>
        <div class="toolbar">
          <button class="btn" id="eval-edit-cancel">Cancelar</button>
          <div class="spacer"></div>
          <button class="btn primary" id="eval-edit-save">Guardar cambios</button>
        </div>
      </div>
      <div class="card" style="margin-top: 1rem;">
        <div class="section-title">Equipos asociados</div>
        <div class="row eval-filters">
          <div class="w-3">
            <label>Equipo</label>
            <input id="eval-filter-equipo" placeholder="EquipNo o Nombre" />
          </div>
          <div class="w-3">
            <label>Fleet</label>
            <select id="eval-filter-fleet" class="form-select"></select>
          </div>
          <div class="w-3">
            <label>Proceso</label>
            <select id="eval-filter-proceso" class="form-select"></select>
          </div>
          <div class="w-3">
            <label>EGI</label>
            <select id="eval-filter-egi" class="form-select"></select>
          </div>
        </div>
        <div class="toolbar">
          <span class="muted" id="eval-equipos-count">-</span>
          <div class="spacer"></div>
          <button class="btn" id="eval-equipos-prev">¬´</button>
          <input id="eval-equipos-page" class="page-input" value="1" />
          <span class="muted" id="eval-equipos-pages">/ 1</span>
          <button class="btn" id="eval-equipos-next">¬ª</button>
        </div>
        <div id="eval-equipos-table"></div>
      </div>
    </section>

    <div class="footer">AC - Activos del sitio</div>
      </div>
    </main>
  </div>

  <script src="js/spHttp.js"></script>
  <script src="js/catalogService.js"></script>
  <script src="js/scenarioService.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="js/matrixModal.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
